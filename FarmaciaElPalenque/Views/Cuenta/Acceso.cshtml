@model Usuario
@{
    ViewData["Title"] = "Acceso";
    var returnUrl = Context.Request.Query["returnUrl"].ToString();
    ViewData["ReturnUrl"] = string.IsNullOrEmpty(returnUrl) ? (ViewBag.ReturnUrl ?? "") : returnUrl;
}

<div class="container my-4">
    <div class="auth-wrap">
        @{
            var esAdmin = Context.Session.GetString("Rol") == "Administrador";
        }
        <div class="row g-4">
            <div class="col-12 col-lg-6">
                <div class="auth-card h-100">
                    <h4 class="mb-1">Ya tengo una cuenta</h4>
                    <p class="text-muted mb-3">Para iniciar sesión ingresá tu email y contraseña.</p>

                    @if (!esAdmin)
                    {
                        @await Html.PartialAsync("/Views/Shared/Account/_LoginForm.cshtml",
                        new FarmaciaElPalenque.Models.Usuario())
                                        }
                    else
                    {
                        <div class="alert alert-info mb-0">
                            Estás logueado como <strong>Administrador</strong>. Solo se muestra el registro para crear nuevas cuentas.
                        </div>
                    }
                </div>
            </div>

            <div class="col-12 col-lg-6">
                <div class="auth-card h-100 d-flex flex-column">
                    <h4 class="mb-1">Crear cuenta</h4>
                    <p class="text-muted mb-3">Creá una cuenta y aprovechá los beneficios.</p>

                    <!--
                    <div class="row g-3 mb-3">
                        <div class="col-6 col-md-3"><div class="benefit"><i class="bi bi-basket"></i>Compra rápida</div></div>
                        <div class="col-6 col-md-3"><div class="benefit"><i class="bi bi-heart"></i>Guardado</div></div>
                        <div class="col-6 col-md-3"><div class="benefit"><i class="bi bi-box-seam"></i>Seguimiento</div></div>
                        <div class="col-6 col-md-3"><div class="benefit"><i class="bi bi-list-check"></i>Datos guardados</div></div>
                    </div>
                    -->

                    <div class="flex-grow-1">
                        @await Html.PartialAsync("/Views/Shared/Account/_RegisterForm.cshtml",
                                                new FarmaciaElPalenque.Models.Usuario { rol = "Cliente" })
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // OJO login
        (function () {
            const btn = document.getElementById('togglePasswordLogin');
            const input = document.getElementById('passwordHashLogin');
            const icon = btn ? btn.querySelector('i') : null;
            if (btn && input) {
                btn.addEventListener('click', function () {
                    const isPwd = input.type === 'password';
                    input.type = isPwd ? 'text' : 'password';
                    if (icon) { icon.classList.toggle('bi-eye', isPwd); icon.classList.toggle('bi-eye-slash', !isPwd); }
                });
            }
        })();

        // OJO registro
        (function () {
            const btn1 = document.getElementById('togglePasswordReg');
            const in1 = document.getElementById('passwordHashReg');
            const i1 = btn1 ? btn1.querySelector('i') : null;

            const btn2 = document.getElementById('toggleConfirmPassword');
            const in2 = document.getElementById('confirmarPasswordHashReg');
            const i2 = btn2 ? btn2.querySelector('i') : null;

            function hook(btn, input, icon) {
                if (!btn || !input) return;
                btn.addEventListener('click', function () {
                    const isPwd = input.type === 'password';
                    input.type = isPwd ? 'text' : 'password';
                    if (icon) { icon.classList.toggle('bi-eye', isPwd); icon.classList.toggle('bi-eye-slash', !isPwd); }
                });
            }
            hook(btn1, in1, i1);
            hook(btn2, in2, i2);
        })();
    </script>

    <partial name="_ValidationScriptsPartial" />
    <script src="~/lib/jquery-validation/dist/localization/messages_es.js"></script>
}
